<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤å…·å€Ÿç”¨ç³»çµ±</title>
    
    <!-- 1. å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 3. å¼•å…¥ Babel (è®“ç€è¦½å™¨çœ‹æ‡‚ React ç¨‹å¼ç¢¼) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. å¼•å…¥ Firebase (Compatç‰ˆæœ¬ï¼Œé©åˆå–®ä¸€æª”æ¡ˆä½¿ç”¨) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        /* é˜²æ­¢ iOS é»æ“Šç¸®æ”¾ */
        button { touch-action: manipulation; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        // --- âš ï¸ è¨­å®šå€ï¼šè«‹å°‡é€™è£¡æ›¿æ›æˆä½ çš„ Firebase è¨­å®š ---
        // è«‹å¾ Firebase Console -> Project Settings -> General -> Your apps è¤‡è£½
        // æ³¨æ„ï¼šå¦‚æœé€™äº›å€¼é‚„æ˜¯ "ä½ çš„_API_KEY"ï¼Œç³»çµ±å°‡ç„¡æ³•é‹ä½œ
        const firebaseConfig = {
  apiKey: "AIzaSyDKXhvIBrQpJ2zfXFB544aFDiVmTWW1zaE",
  authDomain: "schooltablewaresystem.firebaseapp.com",
  projectId: "schooltablewaresystem",
  storageBucket: "schooltablewaresystem.firebasestorage.app",
  messagingSenderId: "652083653766",
  appId: "1:652083653766:web:1efbf2e614a4b935e1b507"
};
        // ------------------------------------------------

        const { useState, useEffect } = React;

        // --- åˆå§‹åŒ–æª¢æŸ¥ ---
        let auth, db;
        let isConfigured = false;

        // ç°¡å–®æª¢æŸ¥æ˜¯å¦å·²è¨­å®š Config
        if (firebaseConfig.apiKey !== "ä½ çš„_API_KEY" && firebaseConfig.projectId !== "ä½ çš„å°ˆæ¡ˆID") {
            if (!firebase.apps.length) {
                try {
                    firebase.initializeApp(firebaseConfig);
                    isConfigured = true;
                } catch (e) {
                    console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", e);
                }
            } else {
                isConfigured = true;
            }
            
            if (isConfigured) {
                auth = firebase.auth();
                db = firebase.firestore();
            }
        }

        // --- å…ƒä»¶ï¼šè¨­å®šéŒ¯èª¤æç¤º ---
        const ConfigError = () => (
            <div className="min-h-screen flex items-center justify-center bg-red-50 p-4">
                <div className="bg-white p-8 rounded-2xl shadow-xl max-w-lg text-center border-l-8 border-red-500">
                    <h1 className="text-2xl font-bold text-red-600 mb-4">âš ï¸ ç³»çµ±å°šæœªè¨­å®š</h1>
                    <p className="text-gray-600 mb-4 text-left leading-relaxed">
                        é€™æ˜¯ä¸€å€‹å¸¸è¦‹çš„éŒ¯èª¤ã€‚æ‚¨ç›®å‰ä½¿ç”¨çš„æ˜¯é è¨­çš„ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼Œå°šæœªå¡«å…¥æ‚¨è‡ªå·±çš„ Firebase è³‡æ–™åº«é‘°åŒ™ã€‚
                    </p>
                    <div className="bg-gray-100 p-4 rounded-lg text-left text-sm font-mono text-gray-700 mb-6 overflow-x-auto">
                        const firebaseConfig = &#123;<br/>
                        &nbsp;&nbsp;apiKey: <span className="text-red-500">"ä½ çš„_API_KEY"</span>, // è«‹æ›¿æ›é€™è£¡<br/>
                        &nbsp;&nbsp;...<br/>
                        &#125;;
                    </div>
                    <p className="text-gray-500 text-sm">è«‹ç”¨è¨˜äº‹æœ¬æ‰“é–‹ <b>index.html</b>ï¼Œæ‰¾åˆ°ç¬¬ 35 è¡Œå·¦å³çš„è¨­å®šå€ï¼Œå¡«å…¥æ­£ç¢ºè³‡æ–™å¾Œå­˜æª”é‡æ–°æ•´ç†ã€‚</p>
                </div>
            </div>
        );

        // --- å…ƒä»¶ï¼šæ•¸å­—éµç›¤ ---
        const NumberPad = ({ value, onChange }) => {
            const handleNumClick = (num) => {
                if (value.length < 6) onChange(value + num);
            };

            return (
                <div className="grid grid-cols-3 gap-3 max-w-xs mx-auto mt-4">
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (
                        <button key={num} onClick={() => handleNumClick(num.toString())}
                            className="bg-white hover:bg-blue-50 text-blue-600 font-bold text-2xl py-4 rounded-xl shadow-sm border-b-4 border-blue-200 active:border-b-0 active:translate-y-1 transition-all">
                            {num}
                        </button>
                    ))}
                    <button onClick={() => onChange('')} className="bg-red-100 text-red-600 font-bold text-lg py-4 rounded-xl shadow-sm border-b-4 border-red-200 active:border-b-0 active:translate-y-1">
                        æ¸…é™¤
                    </button>
                    <button onClick={() => handleNumClick('0')} className="bg-white text-blue-600 font-bold text-2xl py-4 rounded-xl shadow-sm border-b-4 border-blue-200 active:border-b-0 active:translate-y-1">
                        0
                    </button>
                    <button onClick={() => onChange(value.slice(0, -1))} className="bg-gray-100 text-gray-600 font-bold text-lg py-4 rounded-xl shadow-sm border-b-4 border-gray-300 active:border-b-0 active:translate-y-1">
                        âŒ«
                    </button>
                </div>
            );
        };

        // --- ä¸»æ‡‰ç”¨ç¨‹å¼ ---
        function TablewareSystem() {
            if (!isConfigured) {
                return <ConfigError />;
            }

            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [studentId, setStudentId] = useState('');
            const [selectedItems, setSelectedItems] = useState({ bowl: false, spoon: false, chopsticks: false });
            const [loading, setLoading] = useState(false);
            const [activeBorrows, setActiveBorrows] = useState([]);
            const [allActiveBorrows, setAllActiveBorrows] = useState([]);
            const [successMessage, setSuccessMessage] = useState('');
            const appId = 'default-app-id'; 

            // èªè­‰
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await auth.signInAnonymously();
                    } catch (error) {
                        console.error("Auth Error:", error);
                        if (error.code === 'auth/network-request-failed') {
                            alert("ç„¡æ³•é€£ç·šåˆ°è³‡æ–™åº«ã€‚\n\nè«‹æª¢æŸ¥ï¼š\n1. ç¶²è·¯æ˜¯å¦é€šæš¢\n2. Firebase Config è¨­å®šæ˜¯å¦æ­£ç¢º\n3. æ˜¯å¦æœ‰å»£å‘Šé˜»æ“‹å™¨ (AdBlock) æ“‹ä½äº†é€£ç·š");
                        } else {
                            alert(`ç™»å…¥å¤±æ•—: ${error.message}`);
                        }
                    }
                };
                initAuth();
                return auth.onAuthStateChanged(setUser);
            }, []);

            // ç®¡ç†å“¡ç›£è½ (åªè½æœªæ­¸é‚„)
            useEffect(() => {
                if (!user || view !== 'admin') return;
                const unsubscribe = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('tableware_records')
                    .where('status', '==', 'borrowed')
                    .onSnapshot(snapshot => {
                        const records = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        records.sort((a, b) => new Date(b.borrowTime) - new Date(a.borrowTime));
                        setAllActiveBorrows(records);
                    }, (error) => {
                        console.error("Snapshot Error:", error);
                    });
                return () => unsubscribe();
            }, [user, view]);

            // --- åŒ¯å‡º CSV åŠŸèƒ½ ---
            const exportToCSV = async () => {
                if (!confirm("ç¢ºå®šè¦ä¸‹è¼‰å®Œæ•´çš„æ­·å²å€Ÿç”¨ç´€éŒ„å—ï¼Ÿ")) return;
                setLoading(true);
                try {
                    // 1. æŠ“å–æ‰€æœ‰è³‡æ–™ (ä¸è¨­æ¢ä»¶ï¼Œä¾ç…§æ™‚é–“æ’åº)
                    const snapshot = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('tableware_records')
                        .orderBy('borrowTime', 'desc')
                        .get();

                    if (snapshot.empty) {
                        alert("ç›®å‰æ²’æœ‰ä»»ä½•ç´€éŒ„å–”ï¼");
                        setLoading(false);
                        return;
                    }

                    // 2. å»ºç«‹ CSV å…§å®¹
                    let csvContent = "\uFEFF"; // BOM (é˜²æ­¢ Excel ä¸­æ–‡äº‚ç¢¼)
                    csvContent += "å­¸è™Ÿ,å€Ÿç”¨ç‰©å“,å€Ÿç”¨æ™‚é–“,æ­¸é‚„æ™‚é–“,ç‹€æ…‹\n"; // è¡¨é ­

                    snapshot.docs.forEach(doc => {
                        const data = doc.data();
                        const borrowTime = new Date(data.borrowTime).toLocaleString('zh-TW');
                        const returnTime = data.returnTime ? new Date(data.returnTime).toLocaleString('zh-TW') : "å°šæœªæ­¸é‚„";
                        const status = data.status === 'borrowed' ? 'å€Ÿå‡ºä¸­' : 'å·²æ­¸é‚„';
                        const items = data.items.join('ã€'); // å°‡é™£åˆ—è½‰ç‚ºå­—ä¸²

                        // çµ„åˆä¸€è¡Œï¼Œä¸¦è™•ç†å¯èƒ½åŒ…å«é€—è™Ÿçš„æ¬„ä½
                        csvContent += `"${data.studentId}","${items}","${borrowTime}","${returnTime}","${status}"\n`;
                    });

                    // 3. è§¸ç™¼ä¸‹è¼‰
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement("a");
                    const url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", `é¤å…·å€Ÿç”¨ç´€éŒ„_${new Date().toISOString().slice(0,10)}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                } catch (e) {
                    console.error(e);
                    alert("åŒ¯å‡ºå¤±æ•—: " + e.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleBorrow = async () => {
                if (!studentId) return alert("è«‹è¼¸å…¥å­¸è™Ÿ");
                const items = [];
                if (selectedItems.bowl) items.push('ç¢—');
                if (selectedItems.spoon) items.push('æ¹¯åŒ™');
                if (selectedItems.chopsticks) items.push('ç­·å­');
                if (items.length === 0) return alert("è«‹é¸æ“‡é¤å…·");

                setLoading(true);
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('tableware_records').add({
                        studentId, items, borrowTime: new Date().toISOString(), returnTime: null, status: 'borrowed'
                    });
                    setSuccessMessage(`å¥½æ£’ï¼${studentId} è™ŸåŒå­¸ï¼Œå€Ÿç”¨æˆåŠŸï¼`);
                    setView('success');
                    setTimeout(resetForm, 3000);
                } catch (e) { 
                    console.error(e);
                    alert("å€Ÿç”¨å¤±æ•—: " + e.message + "\nè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š"); 
                } finally { setLoading(false); }
            };

            const checkBorrowsForReturn = async () => {
                if (!studentId) return;
                setLoading(true);
                try {
                    const snapshot = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('tableware_records')
                        .where('studentId', '==', studentId).where('status', '==', 'borrowed').get();
                    setActiveBorrows(snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setView('return_list');
                } catch (e) { 
                    console.error(e);
                    alert("æŸ¥è©¢å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯"); 
                } finally { setLoading(false); }
            };

            const handleReturn = async (recordId) => {
                setLoading(true);
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('tableware_records').doc(recordId)
                        .update({ returnTime: new Date().toISOString(), status: 'returned' });
                    const remaining = activeBorrows.filter(item => item.id !== recordId);
                    setActiveBorrows(remaining);
                    if (remaining.length === 0) {
                        setSuccessMessage(`${studentId} è™ŸåŒå­¸ï¼Œè¬è¬ä½ æ­¸é‚„é¤å…·ï¼`);
                        setView('success');
                        setTimeout(resetForm, 3000);
                    }
                } catch (e) { alert("æ­¸é‚„å¤±æ•—"); } finally { setLoading(false); }
            };

            const resetForm = () => {
                setStudentId(''); setSelectedItems({ bowl: false, spoon: false, chopsticks: false });
                setView('home'); setSuccessMessage('');
            };

            // --- é é¢æ¸²æŸ“ ---
            if (view === 'home') return (
                <div className="min-h-screen bg-amber-50 flex flex-col items-center justify-center p-4 font-sans">
                    <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-lg text-center border-b-8 border-amber-200">
                        <h1 className="text-3xl font-bold text-amber-800 mb-2">ğŸ« é¤å…·å€Ÿç”¨ç«™</h1>
                        <p className="text-gray-500 mb-8">è«‹é¸æ“‡ä½ è¦åšä»€éº¼ï¼Ÿ</p>
                        <div className="grid grid-cols-2 gap-6">
                            <button onClick={() => setView('borrow_auth')} className="flex flex-col items-center justify-center bg-green-100 hover:bg-green-200 border-b-4 border-green-300 active:border-b-0 active:translate-y-1 p-6 rounded-2xl transition-all h-48">
                                <div className="bg-green-500 text-white text-4xl p-4 rounded-full mb-3 shadow-md">ğŸ´</div>
                                <span className="text-2xl font-bold text-green-800">æˆ‘è¦å€Ÿ</span>
                            </button>
                            <button onClick={() => setView('return_auth')} className="flex flex-col items-center justify-center bg-blue-100 hover:bg-blue-200 border-b-4 border-blue-300 active:border-b-0 active:translate-y-1 p-6 rounded-2xl transition-all h-48">
                                <div className="bg-blue-500 text-white text-4xl p-4 rounded-full mb-3 shadow-md">â†©ï¸</div>
                                <span className="text-2xl font-bold text-blue-800">æˆ‘è¦é‚„</span>
                            </button>
                        </div>
                        <button onClick={() => setView('admin')} className="mt-8 text-gray-400 hover:text-gray-600 text-sm block mx-auto">ğŸ“‹ è€å¸«å°ˆç”¨ç®¡ç†å€</button>
                    </div>
                </div>
            );

            if (view === 'borrow_auth' || view === 'return_auth') return (
                <div className="min-h-screen bg-blue-50 flex flex-col items-center justify-center p-4">
                    <div className="bg-white p-6 rounded-3xl shadow-xl w-full max-w-md border-b-8 border-blue-200">
                        <div className="flex justify-between items-center mb-4">
                            <button onClick={() => setView('home')} className="bg-gray-100 p-2 rounded-full text-xl">â¬…ï¸</button>
                            <h2 className="text-2xl font-bold text-gray-700">{view === 'borrow_auth' ? 'ğŸ‘‹ å€Ÿç”¨ç™»å…¥' : 'ğŸ‘‹ æ­¸é‚„ç™»å…¥'}</h2><div className="w-10"></div>
                        </div>
                        
                        {/* ä¿®æ­£ï¼šè¼¸å…¥æ¡†æ”¹ç‚ºå‹•æ…‹é¡¯ç¤ºï¼Œç§»é™¤å›ºå®šåº•ç·š */}
                        <div className="bg-gray-100 p-4 rounded-xl text-center mb-4 border-2 border-blue-100 h-24 flex items-center justify-center">
                            {studentId ? (
                                <span className="text-5xl font-mono font-bold text-gray-800 tracking-widest">{studentId}</span>
                            ) : (
                                <span className="text-gray-400 text-xl animate-pulse flex items-center gap-2">
                                    <span className="inline-block w-1 h-6 bg-gray-400 animate-bounce"></span>
                                    è«‹è¼¸å…¥è™Ÿç¢¼...
                                </span>
                            )}
                        </div>
                        
                        <div className="text-center mb-4">
                            <p className="text-gray-500 mb-1">è«‹è¼¸å…¥ä½ çš„å­¸è™Ÿæˆ–ç­ç´šåº§è™Ÿ</p>
                            <p className="text-blue-500 text-sm font-bold">ä¾‹å¦‚ï¼š61001 (6å¹´10ç­1è™Ÿ)</p>
                        </div>

                        <NumberPad value={studentId} onChange={setStudentId} />
                        <button onClick={() => { if (!studentId) return; view === 'borrow_auth' ? setView('borrow_select') : checkBorrowsForReturn(); }} disabled={!studentId}
                            className={`w-full mt-6 py-4 rounded-xl text-xl font-bold text-white shadow-md transition-all ${studentId ? 'bg-blue-500 border-b-4 border-blue-700 active:translate-y-1' : 'bg-gray-300'}`}>
                            ä¸‹ä¸€æ­¥
                        </button>
                    </div>
                </div>
            );

            if (view === 'borrow_select') return (
                <div className="min-h-screen bg-green-50 flex flex-col items-center justify-center p-4">
                    <div className="bg-white p-6 rounded-3xl shadow-xl w-full max-w-md border-b-8 border-green-200">
                        <div className="flex justify-between items-center mb-2">
                            <button onClick={() => setView('borrow_auth')} className="bg-gray-100 p-2 rounded-full text-xl">â¬…ï¸</button>
                            <span className="font-bold text-green-700 text-lg">åŒå­¸ {studentId}</span>
                        </div>
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">ä½ è¦å€Ÿä»€éº¼ï¼Ÿ</h2>
                        <div className="space-y-4">
                            <button onClick={() => setSelectedItems({ ...selectedItems, bowl: !selectedItems.bowl })} className={`w-full flex items-center justify-between p-4 rounded-2xl border-2 ${selectedItems.bowl ? 'bg-orange-100 border-orange-500' : 'bg-white border-gray-200'}`}>
                                <div className="flex items-center gap-4"><span className="text-3xl">ğŸ¥£</span><span className="text-2xl font-bold text-gray-700">ç¢—</span></div>
                                {selectedItems.bowl && <span className="text-2xl text-orange-500">âœ…</span>}
                            </button>
                            <button onClick={() => setSelectedItems({ ...selectedItems, spoon: !selectedItems.spoon })} className={`w-full flex items-center justify-between p-4 rounded-2xl border-2 ${selectedItems.spoon ? 'bg-cyan-100 border-cyan-500' : 'bg-white border-gray-200'}`}>
                                <div className="flex items-center gap-4"><span className="text-3xl">ğŸ¥„</span><span className="text-2xl font-bold text-gray-700">æ¹¯åŒ™</span></div>
                                {selectedItems.spoon && <span className="text-2xl text-cyan-500">âœ…</span>}
                            </button>
                            <button onClick={() => setSelectedItems({ ...selectedItems, chopsticks: !selectedItems.chopsticks })} className={`w-full flex items-center justify-between p-4 rounded-2xl border-2 ${selectedItems.chopsticks ? 'bg-purple-100 border-purple-500' : 'bg-white border-gray-200'}`}>
                                <div className="flex items-center gap-4"><span className="text-3xl">ğŸ¥¢</span><span className="text-2xl font-bold text-gray-700">ç­·å­</span></div>
                                {selectedItems.chopsticks && <span className="text-2xl text-purple-500">âœ…</span>}
                            </button>
                        </div>
                        <button onClick={handleBorrow} disabled={loading} className="w-full mt-8 bg-green-500 text-white text-xl font-bold py-4 rounded-xl shadow-lg border-b-4 border-green-700 active:border-b-0 active:translate-y-1">
                            {loading ? 'è™•ç†ä¸­...' : 'ç¢ºèªå€Ÿç”¨'}
                        </button>
                    </div>
                </div>
            );

            if (view === 'return_list') return (
                <div className="min-h-screen bg-blue-50 flex flex-col items-center justify-center p-4">
                    <div className="bg-white p-6 rounded-3xl shadow-xl w-full max-w-md border-b-8 border-blue-200">
                        <div className="flex justify-between items-center mb-4">
                            <button onClick={() => setView('return_auth')} className="bg-gray-100 p-2 rounded-full text-xl">â¬…ï¸</button>
                            <span className="font-bold text-blue-700 text-lg">åŒå­¸ {studentId}</span>
                        </div>
                        <h2 className="text-xl font-bold text-center text-gray-800 mb-2">æœªæ­¸é‚„é …ç›®</h2>
                        {activeBorrows.length === 0 ? (
                            <div className="text-center py-8"><p className="text-lg text-gray-600">ç›®å‰æ²’æœ‰å€Ÿç”¨ç´€éŒ„å–”ï¼</p><button onClick={resetForm} className="mt-4 text-blue-500 font-bold">å›é¦–é </button></div>
                        ) : (
                            <div className="space-y-4 max-h-[60vh] overflow-y-auto">
                                {activeBorrows.map((record) => (
                                    <div key={record.id} className="bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-sm flex items-center justify-between">
                                        <div>
                                            <div className="flex gap-2 mb-1">
                                                {record.items.map((item, idx) => <span key={idx} className="px-2 py-1 bg-blue-100 text-blue-700 rounded-md text-sm font-bold">{item}</span>)}
                                            </div>
                                            <div className="text-xs text-gray-400">ğŸ•’ {new Date(record.borrowTime).toLocaleString('zh-TW')}</div>
                                        </div>
                                        <button onClick={() => handleReturn(record.id)} className="bg-blue-500 text-white px-4 py-2 rounded-lg font-bold shadow-sm">æ­¸é‚„</button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            if (view === 'success') return (
                <div className="min-h-screen bg-green-50 flex flex-col items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-full shadow-2xl animate-bounce mb-8"><span className="text-6xl">âœ…</span></div>
                    <h2 className="text-3xl font-bold text-green-800 text-center mb-4 animate-pulse">å®Œæˆï¼</h2>
                    <p className="text-xl text-gray-600 text-center">{successMessage}</p>
                </div>
            );

            if (view === 'admin') return (
                <div className="min-h-screen bg-gray-100 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-6">
                            <div className="flex items-center gap-3">
                                <button onClick={resetForm} className="bg-white p-2 rounded-lg shadow">â¬…ï¸</button>
                                <h1 className="text-2xl font-bold text-gray-800">ğŸ“Š ç®¡ç†å¾Œå°</h1>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={exportToCSV} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow font-bold text-sm flex items-center gap-1">
                                    ğŸ“¥ åŒ¯å‡º CSV (Excel)
                                </button>
                                <div className="bg-white px-4 py-2 rounded-lg shadow text-sm font-bold text-red-500 flex items-center">
                                    æœªæ­¸é‚„: {allActiveBorrows.length}
                                </div>
                            </div>
                        </div>
                        <div className="bg-white rounded-2xl shadow-sm overflow-hidden overflow-x-auto">
                            <table className="w-full text-left">
                                <thead className="bg-gray-50 border-b border-gray-100">
                                    <tr><th className="p-4">å­¸è™Ÿ</th><th className="p-4">ç‰©å“</th><th className="p-4">æ™‚é–“</th><th className="p-4">æ“ä½œ</th></tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100">
                                    {allActiveBorrows.length === 0 ? (
                                        <tr><td colSpan="4" className="p-8 text-center text-gray-400">å¤ªæ£’äº†ï¼æ‰€æœ‰é¤å…·éƒ½å·²æ­¸é‚„</td></tr>
                                    ) : (
                                        allActiveBorrows.map((r) => (
                                            <tr key={r.id} className="hover:bg-gray-50">
                                                <td className="p-4 font-bold">{r.studentId}</td>
                                                <td className="p-4">{r.items.join(', ')}</td>
                                                <td className="p-4 text-sm text-gray-500">{new Date(r.borrowTime).toLocaleString('zh-TW')}</td>
                                                <td className="p-4"><button onClick={() => handleReturn(r.id)} className="text-blue-500 font-bold">å¼·åˆ¶æ­¸é‚„</button></td>
                                            </tr>
                                        ))
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TablewareSystem />);
    </script>
</body>
</html>
