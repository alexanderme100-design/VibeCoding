<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>校長師徒制實施成效問卷</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <script>
    // ★★★ 請在此處貼上您 Google Apps Script 部署後的網址 (以 /exec 結尾) ★★★
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx4zL-EmQKj-2QnEC5eLD9YlTu5TSFgKxGYFu_mawQ7Jt449tZLYuTh3HdijhYLHwqJBA/exec";
  </script>

  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      transition: background-color 0.8s ease-in-out;
    }
    
    /* 隱藏預設的 Radio Button */
    .scale-input {
      display: none;
    }

    /* 量表按鈕樣式 */
    .scale-label {
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px; /* 圓角矩形 */
      border: 2px solid #e5e7eb;
      background-color: white;
      color: #6b7280;
      font-weight: bold;
      transition: all 0.2s;
    }

    @media (min-width: 640px) {
      .scale-label {
        width: 48px;
        height: 48px;
        font-size: 1.1rem;
      }
    }

    /* 選中狀態 - 按鈕 */
    .scale-input:checked + .scale-label {
      background-color: #4f46e5; /* Indigo-600 */
      border-color: #4f46e5;
      color: white;
      transform: scale(1.1);
      box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
    }

    /* 選中狀態 - 下方文字 */
    .scale-input:checked ~ .scale-text {
      color: #4f46e5;
      font-weight: 700;
    }
    
    /* Hover 效果 */
    .scale-label:hover {
      border-color: #a5b4fc;
      background-color: #f9fafb;
    }

    /* 卡片切換動畫 */
    .page-section {
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .page-section.active {
      display: block;
      opacity: 1;
    }

    /* 莫蘭迪色系定義 */
    .bg-theme-welcome { background-color: #F3F4F6; } /* 淺灰 */
    .bg-theme-basic { background-color: #E5E7EB; }   /* 稍深灰 */
    .bg-theme-d1 { background-color: #D8E2DC; }      /* 莫蘭迪綠 (Sage) */
    .bg-theme-d2 { background-color: #D1D9E6; }      /* 莫蘭迪藍 (Dusty Blue) */
    .bg-theme-d3 { background-color: #E8E0D5; }      /* 莫蘭迪杏 (Warm Sand) */
    .bg-theme-d4 { background-color: #E0D6E4; }      /* 莫蘭迪紫 (Muted Lavender) */
    .bg-theme-d5 { background-color: #E2CFCF; }      /* 莫蘭迪粉 (Dusty Rose) */
    .bg-theme-open { background-color: #F0F2F5; }    /* 結尾灰藍 */

    /* 進度條樣式 */
    .progress-bar-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background-color: rgba(255,255,255,0.5);
      z-index: 50;
    }
    .progress-bar {
      height: 100%;
      background-color: #4f46e5;
      width: 0%;
      transition: width 0.5s ease;
    }

    /* 題目卡片 */
    .question-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }

    /* 自定義 Alert 動畫 */
    @keyframes bounceIn {
      0% { transform: scale(0.9); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .custom-alert-box {
      animation: bounceIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
  </style>
</head>
<body class="bg-theme-welcome text-gray-800 antialiased min-h-screen pb-20">

  <!-- 進度條 -->
  <div class="progress-bar-container">
    <div id="progressBar" class="progress-bar"></div>
  </div>

  <div class="max-w-3xl mx-auto px-4 py-8 mt-4">
    <form id="mainForm" onsubmit="handleFormSubmit(event)">
      
      <!-- 頁面 0: 歡迎頁 & 說明 -->
      <div id="page-0" class="page-section active">
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-8 border-indigo-600">
          <h1 class="text-3xl font-bold text-gray-900 mb-4 text-center">中小學階段校長師徒制實施成效問卷</h1>
          <div class="space-y-4 text-gray-600 leading-relaxed">
            <p>敬愛的校長您好：</p>
            <p>感謝您撥冗參與填寫。本問卷旨在了解您對於「校長師徒制」的看法與實際經驗。問卷分為基本資料與成效量表兩部分。</p>
            <p>為了讓您填寫更舒適，本問卷採用分頁設計，每個向度約 10 題。請依據您的實際經驗或認知，直觀地選擇最符合的程度。</p>
            <ul class="list-disc list-inside bg-gray-50 p-4 rounded-lg text-sm">
              <li><strong>填答時間：</strong>約 5-8 分鐘</li>
              <li><strong>資料用途：</strong>僅作為學術研究與政策參考，內容絕對保密。</li>
            </ul>
          </div>
          <div class="mt-8 text-center">
            <button type="button" onclick="nextPage(1)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transform transition hover:scale-105">
              開始填寫
            </button>
          </div>
        </div>
      </div>

      <!-- 頁面 1: 基本資料 -->
      <div id="page-1" class="page-section">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">壹、基本資料</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">1. 性別</label>
              <select name="gender" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="男">男</option>
                <option value="女">女</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">2. 年齡</label>
              <select name="age" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="30歲以下">30歲(含)以下</option>
                <option value="31-40歲">31-40歲</option>
                <option value="41-50歲">41-50歲</option>
                <option value="51-60歲">51-60歲</option>
                <option value="61歲以上">61歲以上</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">3. 最高學歷</label>
              <select name="education" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="學士">學士</option>
                <option value="碩士">碩士 (含40學分班)</option>
                <option value="博士">博士</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">4. 擔任校長總年資</label>
              <select name="years" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="4年以下">4年(含)以下</option>
                <option value="5-8年">5-8年</option>
                <option value="9-12年">9-12年</option>
                <option value="13年以上">13年(含)以上</option>
              </select>
            </div>

            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">5. 您在師徒制中的角色</label>
              <select name="role" id="roleSelect" onchange="toggleRoleOther()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="初任校長">初任校長（受輔導者）</option>
                <option value="師傅校長">師傅校長（輔導者）</option>
                <option value="其他">其他</option>
              </select>
              <input type="text" id="roleOther" name="role_other" placeholder="請說明您的角色" class="hidden mt-2 w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50 transition-all duration-300">
            </div>

             <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">6. 服務學校階段別</label>
              <select name="stage" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="國小">國小</option>
                <option value="國中">國中</option>
                <option value="高中職">高中職</option>
              </select>
            </div>
             <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">7. 學校規模</label>
              <select name="size" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="12班以下">12班(含)以下</option>
                <option value="13-24班">13-24班</option>
                <option value="25-47班">25-47班</option>
                <option value="48班以上">48班以上</option>
              </select>
            </div>
             <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">8. 學校所在地區</label>
              <select name="location" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="都市型">都市型</option>
                <option value="鄉鎮型">鄉鎮型</option>
                <option value="偏遠或離島型">偏遠或離島型</option>
              </select>
            </div>
            
             <!-- 9. 行政區 (連動式選單) -->
             <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">9. 行政區</label>
              <div class="grid grid-cols-2 gap-4">
                <!-- 第一層：類型選擇 -->
                <select id="districtCategory" onchange="updateDistrictOptions()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50">
                  <option value="">請選擇類型</option>
                  <option value="6city">6個直轄市</option>
                  <option value="13county">13個縣</option>
                  <option value="3city">3個省轄市</option>
                </select>
                <!-- 第二層：具體縣市 (注意 name="district" 讓後端接收正確值) -->
                <select name="district" id="districtSpecific" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required disabled>
                  <option value="">請先選擇類型</option>
                </select>
              </div>
            </div>

             <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">10. 是否曾參與師徒制度</label>
              <select name="participated" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="是">是</option>
                <option value="否">否</option>
              </select>
            </div>
             <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">11. 配對方式</label>
              <select name="pairType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-gray-50" required>
                <option value="">請選擇</option>
                <option value="正式官方">正式官方師徒制</option>
                <option value="非正式固定">非正式固定師徒關係</option>
                <option value="同儕教練">同儕教練/學習社群</option>
                <option value="尚未參與">尚未參與</option>
              </select>
            </div>
          </div>

          <div class="flex justify-between mt-8">
             <button type="button" onclick="prevPage(0)" class="text-gray-500 hover:text-gray-700 font-medium px-6 py-2">上一步</button>
            <button type="button" onclick="nextPage(2)" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full shadow-lg">
              進入問卷
            </button>
          </div>
        </div>
      </div>

      <!-- 量表容器 -->
      <div id="dimensions-container"></div>

      <!-- 開放式問題頁面 (Page 7) -->
      <div id="page-7" class="page-section">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
          <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">參、開放式意見</h2>
          
          <div class="space-y-6">
            <div>
              <label class="block font-medium text-gray-700 mb-2">1. 在參與師徒制的過程中，您認為最困難或最缺乏支持的部分是什麼？</label>
              <textarea name="open_1" rows="3" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500"></textarea>
            </div>
            
            <div>
              <label class="block font-medium text-gray-700 mb-2">2. 您認為師徒制對校長專業發展產生「最大影響」或「最需改進」的關鍵點為何？</label>
              <textarea name="open_2" rows="3" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500"></textarea>
            </div>

            <div>
              <label class="block font-medium text-gray-700 mb-2">3. 遇到問題時，您最常諮詢的對象是？（單選）</label>
              <select name="open_3" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-indigo-500">
                <option value="">請選擇</option>
                <option value="師傅校長">師傅校長（正式）</option>
                <option value="前任校長">前任校長</option>
                <option value="同儕校長">同儕校長</option>
                <option value="教育局處">教育局/處承辦人</option>
                <option value="校內主任">校內主任群</option>
                <option value="退休校長">退休校長</option>
                <option value="學會社群">校長學會或專業社群</option>
                <option value="其他">其他</option>
              </select>
            </div>

            <div class="p-4 bg-indigo-50 rounded-lg">
              <label class="block font-medium text-indigo-900 mb-2">Q：您最想諮詢的對象為何人？</label>
              <input type="text" name="open_4_target" placeholder="姓名／職稱／任職學校" class="w-full p-3 border border-indigo-200 rounded-lg mb-2 focus:ring-2 focus:ring-indigo-500">
              <input type="text" name="open_4_reason" placeholder="選擇這位對象的原因為何？" class="w-full p-3 border border-indigo-200 rounded-lg focus:ring-2 focus:ring-indigo-500">
            </div>
          </div>

          <div class="flex justify-between mt-8">
            <button type="button" onclick="prevPage(6)" class="text-gray-500 hover:text-gray-700 font-medium px-6 py-2">上一步</button>
            <button type="submit" id="submitBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transform transition hover:scale-105">
              提交問卷
            </button>
          </div>
        </div>
      </div>

    </form>
    
    <!-- 自定義警告視窗 (Modal) -->
    <div id="custom-alert" class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
      <div class="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 shadow-2xl custom-alert-box transform transition-all">
        <div class="text-center">
          <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-red-100 mb-6">
            <svg class="h-12 w-12 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
          </div>
          <h3 class="text-3xl font-bold text-gray-900 mb-4">還有題目未填寫！</h3>
          <p class="text-xl text-gray-600 mb-8">請檢查標示紅色的欄位。</p>
          <button onclick="closeCustomAlert()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white text-2xl font-bold py-4 px-6 rounded-xl shadow-lg focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-transform transform active:scale-95">
            好，我去檢查
          </button>
        </div>
      </div>
    </div>

    <!-- 載入中遮罩 -->
    <div id="loading" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-6 rounded-lg shadow-xl text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
        <p class="text-gray-700 font-bold">資料送出中，請稍候...</p>
      </div>
    </div>

    <!-- 成功畫面 -->
    <div id="success-page" class="hidden text-center py-20">
      <div class="bg-white rounded-2xl shadow-xl p-10 inline-block max-w-lg">
        <div class="text-green-500 text-6xl mb-4">✓</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">感謝您的填寫！</h2>
        <p class="text-gray-600">您的意見對校長專業發展至關重要。</p>
        <p class="text-gray-500 text-sm mt-4">視窗可直接關閉</p>
      </div>
    </div>

  </div>

  <script>
    // --- 角色說明切換邏輯 ---
    function toggleRoleOther() {
      const select = document.getElementById('roleSelect');
      const otherInput = document.getElementById('roleOther');
      
      if (select.value === '其他') {
        otherInput.classList.remove('hidden');
        otherInput.setAttribute('required', 'required');
        setTimeout(() => otherInput.focus(), 100);
      } else {
        otherInput.classList.add('hidden');
        otherInput.removeAttribute('required');
        otherInput.value = '';
        otherInput.classList.remove('border-red-500');
      }
    }

    // --- 行政區連動邏輯 ---
    const districtMapping = {
       "6city": ["臺北市", "新北市", "桃園市", "臺中市", "臺南市", "高雄市"],
       "13county": ["新竹縣", "苗栗縣", "彰化縣", "南投縣", "雲林縣", "嘉義縣", "屏東縣", "宜蘭縣", "花蓮縣", "臺東縣", "澎湖縣", "金門縣", "連江縣"],
       "3city": ["基隆市", "新竹市", "嘉義市"]
    };

    function updateDistrictOptions() {
       const category = document.getElementById('districtCategory').value;
       const specificSelect = document.getElementById('districtSpecific');
       
       specificSelect.innerHTML = '<option value="">請選擇區域</option>';
       
       if (category && districtMapping[category]) {
           specificSelect.disabled = false;
           districtMapping[category].forEach(place => {
               const option = document.createElement('option');
               option.value = place;
               option.textContent = place;
               specificSelect.appendChild(option);
           });
       } else {
           specificSelect.disabled = true;
           specificSelect.innerHTML = '<option value="">請先選擇類型</option>';
       }
    }

    // --- 資料定義 ---
    const dimensions = [
      {
        id: 1,
        title: "向度一：校務經營與危機管理",
        desc: "本向度聚焦於師傅校長在協助初任校長應對「校務經營」全貌的指導成效。它涵蓋了常態性的行政管理（如財務、總務、法規）、日常實務問題的解決，以及非常態的危機事件預防、應變與善後處理能力。",
        questions: [
          "師傅校長能提供初任校長學校總務行政事務的專業指導。",
          "師傅校長能引導初任校長做有效的時間管理，提升行政處理效能。",
          "師傅校長能引導初任校長建立全方位的校園安全管理系統。",
          "師傅校長能提升初任校長在重大壓力情境中的策略性決策能力。",
          "師傅校長能提升初任校長在危機事件中的整合性處理能力。",
          "師傅校長能引導初任校長在校園安全事件中，熟稔標準作業處理流程。",
          "師傅校長能引導初任校長進行校內有限資源的策略性分配及運用。",
          "師傅校長能引導初任校長從錯誤決策中進行事後檢討汲取經驗。",
          "師傅校長能引導初任校長運用有效的授權策略，以促進學校行政順暢運作。",
          "師傅校長能引導初任校長在危機後，妥適安撫師生情緒的輔導。"
        ]
      },
      {
        id: 2,
        title: "向度二：師徒關係與關懷支持",
        desc: "本向度聚焦於師徒互動的品質與情感功能。它涵蓋了建立一個安全、保密、真誠、互惠的信任關係，並在此基礎上，由師傅校長提供同理心，協助初任校長緩解工作壓力、孤立感與焦慮，從而提升其心理韌性與工作滿意度。",
        questions: [
          "師傅校長與初任校長有良好的信任關係。",
          "師傅校長與初任校長有安全信賴的互動氛圍，可以坦誠交流。",
          "師傅校長與初任校長在互動過程中，能彼此相互傾聽與尊重。",
          "師傅校長有同理心，提供初任校長溫暖且有效的情感支持。",
          "師傅校長能有效緩解初任校長的孤立感與工作焦慮。",
          "師傅校長能提升初任校長的工作滿意度。",
          "師傅校長能主動關懷初任校長的身心健康，展現出公事外的支持。",
          "師傅校長能幫助初任校長應對最具挑戰性的工作壓力。",
          "師傅校長所營造的關係氛圍，讓初任校長無後顧之憂尋求協助與指導。",
          "師傅校長能給予積極肯定與賦能，強化初任校長辦學自信心。"
        ]
      },
      {
        id: 3,
        title: "向度三：教學領導與文化形塑",
        desc: "本向度旨在檢視師傅校長在協助初任校長發展教學領導、設定教學方向、課程發展與教學改進、塑造積極學校文化及建立學校願景等核心教育工作的成效。",
        questions: [
          "師傅校長能引導初任校長發展課程與教學領導的專業能力。",
          "師傅校長能引導初任校長釐定學校課程發展方向。",
          "師傅校長能引導初任校長發展實踐學校願景與特色。",
          "師傅校長能提供初任校長形塑或轉化學校組織文化的有效策略。",
          "師傅校長能引導初任校長擬定有效推動學校教學品質改進計畫。",
          "師傅校長能引導初任校長透過系統性的教師專業發展，營造校園的學習型組織文化。",
          "師傅校長能提供有效的激勵策略協助初任校長提升教師的專業投入與動機。",
          "師傅校長能引導初任校長營造一個正向積極的學校文化。",
          "師傅校長能引導初任校長調整學校組織架構，以有效支持核心教學任務。",
          "師傅校長能引導初任校長善用影響力，循序漸進地推動教學變革。"
        ]
      },
      {
        id: 4,
        title: "向度四：人際溝通與關係建立",
        desc: "本向度旨在評估師傅校長在指導初任校長如何與教師、家長、社區等利害關係人建立良好關係、有效溝通、處理人際衝突及建立團隊方面的成效。",
        questions: [
          "師傅校長能引導初任校長與校內外關鍵利害關係人，建立正向的信任關係。",
          "師傅校長能引導初任校長運用有效的溝通策略，以促進同仁間的專業對話與合作。",
          "師傅校長能引導初任校長展現有效的團隊領導力，以凝聚共識並提振士氣。",
          "師傅校長能引導初任校長建立校內正向的溝通機制，營造組織內的互信氛圍。",
          "師傅校長能引導初任校長有效處理親師生之間的互動議題，以建立穩固的教育夥伴關係。",
          "師傅校長能引導初任校長透過賦權增能，來提升行政團隊的整體合作效能。",
          "師傅校長能引導初任校長有效經營與校內外社群的和諧關係。",
          "師傅校長能提供建立穩固親師合作夥伴關係的有效策略。",
          "師傅校長能引導初任校長以公平、審慎的原則，處理教職員的人事議題。",
          "師傅校長能引導初任校長與主管機關及昔日同事建立有效的工作關係。"
        ]
      },
      {
        id: 5,
        title: "向度五：專業反思與自主成長",
        desc: "本向度旨在探討師徒制是否能超越單純的經驗傳承，進而引導初任校長進行深層問題診斷、反思性思考、促進專業技能的實質成長，並培養其獨立解決問題的能力。",
        questions: [
          "師傅校長能引導初任校長運用反思性提問，深入診斷問題根源。",
          "師傅校長能提升初任校長在複雜情境的反思與洞察能力。",
          "師傅校長能提升初任校長的專業自主性、獨立學習及解決問題的能力。",
          "師傅校長能引導初任校長在領導專業技能上的實質成長。",
          "師傅校長能引導初任校長從多元視角分析方案利弊。",
          "師傅校長能協助初任校長從實務經驗中彰顯個人的領導哲學。",
          "師傅校長能引導初任校長運用系統性思考來分析與解決問題。",
          "師傅校長能引導初任校長，將個人專業發展與學校永續發展的目標相結合。",
          "師傅校長能引導初任校長在行政實務中，有效地連結與應用教育理論。",
          "師傅校長能引導初任校長建立清晰的專業自我認同。"
        ]
      }
    ];

    const scaleLabels = ["極不同意", "很不同意", "不同意", "普通", "同意", "很同意", "極為同意"];

    // --- 動態生成 DOM ---
    const container = document.getElementById('dimensions-container');
    
    dimensions.forEach((dim, index) => {
      const pageNum = index + 2; 
      
      let html = `
        <div id="page-${pageNum}" class="page-section">
          <div class="mb-6 bg-white bg-opacity-90 rounded-xl p-4 shadow-sm border-l-4 border-indigo-500">
            <h3 class="text-xl font-bold text-gray-800">${dim.title}</h3>
            <p class="text-sm text-gray-600 mt-1">${dim.desc}</p>
          </div>
          <div class="space-y-6">
      `;

      dim.questions.forEach((qText, qIndex) => {
        const qNum = qIndex + 1;
        const qName = `q_${dim.id}_${qNum}`;
        
        html += `
          <div class="question-card rounded-xl p-5 shadow-sm hover:shadow-md transition-shadow">
            <p class="font-medium text-gray-800 mb-4 text-lg">
              <span class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded mr-2">Q${qNum}</span>
              ${qText}
            </p>
            <div class="flex flex-wrap gap-1 sm:gap-3 justify-center sm:justify-start">
        `;
        
        for(let i=1; i<=7; i++) {
          html += `
            <div class="flex flex-col items-center group">
              <input type="radio" name="${qName}" value="${i}" id="${qName}_${i}" class="scale-input" required>
              <label for="${qName}_${i}" class="scale-label mb-1" title="${scaleLabels[i-1]}">
                ${i}
              </label>
              <span class="scale-text text-[10px] sm:text-xs text-gray-500 group-hover:text-indigo-600 transition-colors cursor-pointer" onclick="document.getElementById('${qName}_${i}').click()">
                ${scaleLabels[i-1]}
              </span>
            </div>
          `;
        }
        
        html += `
            </div>
          </div>
        `;
      });

      html += `
          </div>
          <div class="flex justify-between mt-8">
            <button type="button" onclick="prevPage(${pageNum-1})" class="text-gray-600 hover:text-gray-900 font-medium px-6 py-3 bg-white bg-opacity-50 rounded-lg">← 上一頁</button>
            <button type="button" onclick="nextPage(${pageNum+1})" class="bg-gray-800 hover:bg-black text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105">
              ${pageNum === 6 ? '填寫開放式意見 →' : '下一頁 →'}
            </button>
          </div>
        </div>
      `;
      
      container.innerHTML += html;
    });

    // --- 頁面控制邏輯 ---
    let currentPage = 0;
    const totalPages = 7;
    let pendingScrollTarget = null;

    function updateTheme(page) {
      const body = document.body;
      body.className = body.className.replace(/bg-theme-\w+/g, '');
      
      const themes = [
        'bg-theme-welcome', 'bg-theme-basic', 'bg-theme-d1', 'bg-theme-d2', 
        'bg-theme-d3', 'bg-theme-d4', 'bg-theme-d5', 'bg-theme-open'
      ];
      if (themes[page]) body.classList.add(themes[page]);

      const progress = (page / totalPages) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;
      
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showPage(page) {
      document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
      document.getElementById(`page-${page}`).classList.add('active');
      updateTheme(page);
      currentPage = page;
    }

    function showCustomAlert(scrollTarget) {
      const alertBox = document.getElementById('custom-alert');
      alertBox.classList.remove('hidden');
      pendingScrollTarget = scrollTarget;
    }

    function closeCustomAlert() {
      const alertBox = document.getElementById('custom-alert');
      alertBox.classList.add('hidden');
      
      if (pendingScrollTarget) {
         pendingScrollTarget.scrollIntoView({behavior: 'smooth', block: 'center'});
         if (['SELECT','INPUT','TEXTAREA'].includes(pendingScrollTarget.tagName)) {
             pendingScrollTarget.focus({preventScroll: true});
         }
         pendingScrollTarget = null;
      }
    }

    function validateCurrentPage(page) {
      const container = document.getElementById(`page-${page}`);
      const inputs = container.querySelectorAll('select, input[type="radio"], input[type="text"], textarea');
      let isValid = true;
      let firstInvalidElement = null;
      
      const radioGroups = {};
      
      inputs.forEach(input => {
        if(input.type === 'radio') {
          if(!radioGroups[input.name]) radioGroups[input.name] = false;
          if(input.checked) radioGroups[input.name] = true;
        } else if (input.hasAttribute('required') && !input.value) {
          isValid = false;
          input.classList.add('border-red-500');
          input.addEventListener('input', () => input.classList.remove('border-red-500'));
          if (!firstInvalidElement) firstInvalidElement = input;
        }
      });

      for(let name in radioGroups) {
        if(!radioGroups[name] && document.querySelector(`input[name="${name}"]`).hasAttribute('required')) {
          isValid = false;
          
          const firstRadio = document.querySelector(`input[name="${name}"]`);
          const card = firstRadio.closest('.question-card');
          const elementToHighlight = card || firstRadio.parentElement;
          
          if (elementToHighlight) {
             if (elementToHighlight.classList.contains('question-card')) {
                 elementToHighlight.classList.add('ring-2', 'ring-red-400');
             } else {
                 elementToHighlight.style.border = "2px solid #ef4444"; 
                 elementToHighlight.style.borderRadius = "0.5rem";
                 elementToHighlight.style.padding = "0.5rem";
             }
          }

          const radios = document.getElementsByName(name);
          radios.forEach(r => r.addEventListener('change', () => {
              if (elementToHighlight) {
                  if (elementToHighlight.classList.contains('question-card')) {
                      elementToHighlight.classList.remove('ring-2', 'ring-red-400');
                  } else {
                      elementToHighlight.style.border = "";
                      elementToHighlight.style.padding = "";
                  }
              }
          }));
          
          if (!firstInvalidElement) firstInvalidElement = elementToHighlight || firstRadio;
        }
      }

      if(!isValid) {
        showCustomAlert(firstInvalidElement);
      }
      return isValid;
    }

    function nextPage(targetPage) {
      if(targetPage > currentPage && !validateCurrentPage(currentPage)) return;
      showPage(targetPage);
    }

    function prevPage(targetPage) {
      showPage(targetPage);
    }

    // --- 表單提交 (改為 Fetch) ---
    function handleFormSubmit(e) {
      e.preventDefault();
      
      // 檢查網址是否已設定
      if (!SCRIPT_URL || SCRIPT_URL.includes("您的_GOOGLE_APPS_SCRIPT")) {
        alert("請先在 index.html 程式碼中設定正確的 GAS 部署網址！");
        return;
      }

      document.getElementById('loading').classList.remove('hidden');
      const form = document.getElementById('mainForm');
      
      const formData = {};
      new FormData(form).forEach((value, key) => {
        formData[key] = value;
      });

      // 使用 Fetch API 發送資料
      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(formData),
        // 重要：GAS 的 doPost 需要 text/plain 以避免 CORS 預檢失敗，但我們在後端用 JSON.parse 解析
        headers: {
          "Content-Type": "text/plain;charset=utf-8"
        }
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById('loading').classList.add('hidden');
        if (data.result === 'success') {
          form.style.display = 'none';
          document.getElementById('success-page').classList.remove('hidden');
        } else {
          alert('提交失敗: ' + data.error);
        }
      })
      .catch(error => {
        document.getElementById('loading').classList.add('hidden');
        console.error('Error:', error);
        alert('發生錯誤，請稍後再試。詳細錯誤已記錄在控制台。');
      });
    }

    updateTheme(0);
  </script>
</body>
</html>

