rules_version = '2';service cloud.firestore {match /databases/{database}/documents {// 定義路徑變數
match /artifacts/{appId}/users/{userId}/surveys/{surveyId} {
  
  // 1. [讀取權限細分]
  // allow get: 允許「知道 ID」的人讀取單一問卷 (為了讓民眾填寫)
  allow get: if true;
  
  // allow list: 只有「本人」可以列出問卷清單 (為了保護隱私，不讓別人偷看你有多少問卷)
  allow list: if request.auth != null && request.auth.uid == userId;

  // 2. [寫入權限]
  // 只有本人可以修改或刪除問卷
  allow write: if request.auth != null && request.auth.uid == userId;

  // 3. [回應權限 (Responses)]
  match /responses/{responseId} {
    // 允許任何人 (包括未登入的訪客) 提交回應
    allow create: if true;
    
    // 只有問卷作者本人可以查看統計結果
    allow read: if request.auth != null && request.auth.uid == userId;
  }
}
}}
